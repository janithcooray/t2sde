# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/tzdata/tzdata.conf
# Copyright (C) 2013 - 2024 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

var_insert taropt ' ' "--one-top-level -C $builddir/"
hook_add preconf 5 "tar $taropt $(match_source_file -p tzdata)"

# glibc supplies its own zic binary
if [ "$SDECFG_LIBC" = "musl" ]; then
	hook_add premake 5 "cd $builddir/tzcode*/"
fi

hook_add postmake 5 tzdata_install

tzdata_install() {
	cd $builddir/tzdata*/

	TIMEZONES="africa antarctica asia australasia europe northamerica southamerica etcetera backward"

	mkdir -p $root/usr/share/zoneinfo/{,posix,right}
	zic -y ./yearistype -d $root/usr/share/zoneinfo -L /dev/null $TIMEZONES
	zic -y ./yearistype -d $root/usr/share/zoneinfo/posix -L /dev/null $TIMEZONES
	zic -y ./yearistype -d $root/usr/share/zoneinfo/right -L leapseconds $TIMEZONES
	zic -y ./yearistype -d $root/usr/share/zoneinfo -L/dev/null -p America/New_York
	install -p -m 644 zone.tab iso3166.tab $root/usr/share/zoneinfo/
	install -m644 leap-seconds.list $root/usr/share/zoneinfo/
}
