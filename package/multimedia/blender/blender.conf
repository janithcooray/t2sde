# --- T2-COPYRIGHT-NOTE-BEGIN ---
# T2 SDE: package/*/blender/blender.conf
# Copyright (C) 2023 - 2024 The T2 SDE Project
# 
# This Copyright note is generated by scripts/Create-CopyPatch,
# more information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2.
# --- T2-COPYRIGHT-NOTE-END ---

# fails to link when embree built without avx
var_append cmakeopt ' ' '-DWITH_CYCLES=OFF'
var_append cmakeopt ' ' '-DWITH_CYCLES_EMBREE=OFF'
var_append cmakeopt ' ' "-DWITH_PYTHON_INSTALL=OFF"
var_append cmakeopt ' ' "-DWITH_INSTALL_PORTABLE=OFF -DWITH_LIBS_PRECOMPILED=OFF"

var_append cmakeopt ' ' "-DEpoxy_INCLUDE_DIR=$(pkgprefix includedir epoxy)"

# TODO: properly patch their cursed cmake files!
hook_add premake 5 "touch source/blender/compositor/CMakeFiles/bf_compositor.dir/cmake_pch.hxx.gch"

pkginstalled tbb || var_append cmakeopt ' ' '-DWITH_TBB=OFF'
pkginstalled numpy || var_append cmakeopt ' ' '-DWITH_PYTHON_NUMPY=OFF'

if pkginstalled python; then
	var_append cmakeopt ' ' "-DPYTHON_VERSION=$(mine -q python | cut -d' ' -f2 | cut -d'.' -f-2)"
else
	var_append cmakeopt ' ' "-DWITH_PYTHON=OFF"
fi
